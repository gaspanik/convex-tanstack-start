# Convex + TanStack Start

A full-stack TypeScript application combining **Convex** (real-time backend) with **TanStack Start** (modern React framework). This starter provides a complete setup for building real-time applications with type-safe queries, mutations, and server-side rendering.

## ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           React 19 + TanStack Router        â”‚
â”‚              (src/routes/*)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                          â–¼
  TanStack Query        ConvexQueryClient
  (Data Fetching)       (Real-time Bridge)
         â”‚                          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
            Convex Backend
        (convex/myFunctions.ts)
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                      â–¼
      Queries              Mutations
    (Read-Only)          (Transactional)
         â”‚
         â–¼
   Convex Database
```

**Key Integration**: `@convex-dev/react-query` bridges Convex with TanStack Query, enabling:
- Real-time data synchronization
- Optimistic updates
- Automatic cache management
- Type-safe API calls

## ğŸš€ Quick Start

### Prerequisites
- Node.js 18+
- npm or yarn

### Installation

```bash
git clone <repository>
cd convex-tanstack
npm install
```

### Development

```bash
npm run dev
```

This command:
1. **First run**: Initializes Convex deployment with `convex dev --once`
2. **Subsequent runs**: Runs Convex backend + Vite dev server concurrently

The app opens at `http://localhost:3000` with:
- Hot module reloading for frontend
- Real-time Convex function updates
- Automatic type generation from `convex/_generated/api`

### Environment Variables

Create `.env.local` (auto-generated by Convex CLI):
```
VITE_CONVEX_URL=https://your-deployment.convex.cloud
```

## ğŸ“ Project Structure

```
convex-tanstack/
â”œâ”€â”€ convex/                      # Backend serverless functions
â”‚   â”œâ”€â”€ myFunctions.ts           # Query, mutation, action examples
â”‚   â”œâ”€â”€ schema.ts                # Optional database schema (recommended)
â”‚   â”œâ”€â”€ _generated/              # Auto-generated types (DO NOT EDIT)
â”‚   â”‚   â”œâ”€â”€ api.d.ts             # Type definitions for functions
â”‚   â”‚   â””â”€â”€ server.d.ts          # Convex server utilities
â”‚   â””â”€â”€ README.md                # Convex-specific guide
â”‚
â”œâ”€â”€ src/                         # Frontend React application
â”‚   â”œâ”€â”€ router.tsx               # TanStack Router + ConvexQueryClient setup
â”‚   â”œâ”€â”€ routeTree.gen.ts         # Auto-generated file-based routes (DO NOT EDIT)
â”‚   â”œâ”€â”€ routes/                  # File-based routing (TanStack Router)
â”‚   â”‚   â”œâ”€â”€ __root.tsx           # Root layout with HTML head + Tailwind CSS
â”‚   â”‚   â”œâ”€â”€ index.tsx            # Home page (examples: useSuspenseQuery, useMutation)
â”‚   â”‚   â””â”€â”€ anotherPage.tsx      # Additional route examples
â”‚   â””â”€â”€ styles/
â”‚       â””â”€â”€ app.css              # Tailwind CSS configuration
â”‚
â”œâ”€â”€ public/                      # Static assets
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â””â”€â”€ site.webmanifest
â”‚
â”œâ”€â”€ vite.config.ts               # Vite + TanStack Start plugin config
â”œâ”€â”€ tsconfig.json                # TypeScript configuration with path aliases (~/*â†’src/*)
â”œâ”€â”€ eslint.config.mjs            # ESLint rules for TanStack + Convex
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ copilot-instructions.md  # AI agent guidelines
â”œâ”€â”€ .env.local                   # Environment variables (auto-generated)
â””â”€â”€ package.json                 # Dependencies: React 19, Vite, TanStack, Convex
```

## ğŸ”§ Development Workflows

### Adding a New Convex Function

**File**: `convex/myFunctions.ts`

```typescript
import { query, mutation } from './_generated/server'
import { v } from 'convex/values'
import { api } from './_generated/api'

// Read-only query (reactive)
export const getUsers = query({
  args: { limit: v.number() },
  handler: async (ctx, args) => {
    return await ctx.db.query('users').order('desc').take(args.limit)
  },
})

// Transactional mutation
export const createUser = mutation({
  args: { name: v.string(), email: v.string() },
  handler: async (ctx, args) => {
    return await ctx.db.insert('users', args)
  },
})
```

**Type generation**: Run `npm run dev` or `npx convex dev` to regenerate `convex/_generated/api.d.ts`

### Using Queries in Components

**File**: `src/routes/users.tsx`

```tsx
import { useSuspenseQuery } from '@tanstack/react-query'
import { convexQuery } from '@convex-dev/react-query'
import { api } from '../../convex/_generated/api'

export function UsersList() {
  const { data: users } = useSuspenseQuery(
    convexQuery(api.myFunctions.getUsers, { limit: 50 })
  )
  
  return <ul>{users.map(u => <li key={u._id}>{u.name}</li>)}</ul>
}
```

### Using Mutations in Components

```tsx
import { useMutation } from 'convex/react'
import { api } from '../../convex/_generated/api'

export function AddUserForm() {
  const addUser = useMutation(api.myFunctions.createUser)
  
  const handleSubmit = async (name: string, email: string) => {
    await addUser({ name, email })
  }
  
  return <form onSubmit={(e) => handleSubmit('John', 'john@example.com')}>...</form>
}
```

### Adding a New Route

TanStack Router uses file-based routing:

**Create**: `src/routes/users/index.tsx`
```tsx
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/users/')({
  component: UsersPage,
})

function UsersPage() {
  return <div>Users Page</div>
}
```

Run `npm run dev` to auto-generate `routeTree.gen.ts`.

### Defining Database Schema (Recommended)

**File**: `convex/schema.ts`

```typescript
import { defineSchema, defineTable } from 'convex/server'
import { v } from 'convex/values'

export default defineSchema({
  users: defineTable({
    name: v.string(),
    email: v.string(),
    createdAt: v.number(), // timestamp
  }),
  
  posts: defineTable({
    userId: v.id('users'),
    content: v.string(),
  }).index('by_user', ['userId']),
})
```

Benefits:
- Type-safe document insertion/queries
- Automatic `_id`, `_creationTime` fields
- Index definitions for performance

## ğŸ“¦ Available Scripts

```bash
npm run dev        # Start Convex + Vite dev servers concurrently
npm run dev:web    # Vite dev server only (if Convex already running)
npm run dev:convex # Convex backend server only
npm run dev:ts     # TypeScript watch mode (type checking)
npm run build      # Build for production: Vite bundle + TypeScript check
npm run start      # Run production server
npm run format     # Format code with Prettier
npm run lint       # TypeScript + ESLint validation (no emit)
```

## ğŸ¨ Styling

Uses **Tailwind CSS v4** with the new Vite plugin:

**File**: `src/styles/app.css`
```css
@import "tailwindcss";
```

**Import in layout**: `src/routes/__root.tsx`
```tsx
import appCss from '~/styles/app.css?url'

export const Route = createRootRouteWithContext()({
  head: () => ({
    links: [{ rel: 'stylesheet', href: appCss }],
  }),
  // ...
})
```

**Usage in components**:
```tsx
<button className="px-4 py-2 bg-blue-500 text-white rounded">Click me</button>
```

## ğŸ” Authentication

Convex provides built-in authentication context:

```typescript
export const getUserInfo = query({
  args: {},
  handler: async (ctx) => {
    const identity = await ctx.auth.getUserIdentity()
    if (!identity) return null
    return { name: identity.name, email: identity.email }
  },
})
```

Configure auth providers in Convex dashboard: OAuth, JWT, API keys, etc.

## ğŸ“ Code Quality

### Type Checking
```bash
npm run lint  # TypeScript strict mode + ESLint rules
```

Enforced rules:
- `strict: true`
- `noUnusedLocals: true`
- `noUnusedParameters: true`
- Convex ESLint plugin recommendations

### Formatting
```bash
npm run format  # Prettier with project config
```

### ESLint Config
Uses:
- `@tanstack/eslint-config` (Router/Query best practices)
- `@convex-dev/eslint-plugin` (Convex function validation)
- Ignores: `convex/_generated/`

## ğŸš¢ Deployment

### Convex Deployment
```bash
npx convex deploy
```

Creates production deployment (separate from dev). Handles:
- Schema validation
- Function rollout
- Environment variable management
- Automatic scaling

### Frontend Deployment (Vercel Recommended)

```bash
npm run build    # Creates optimized bundle
npm run start    # Preview production build locally
```

**Vercel**: Connect GitHub repo, auto-deploys on push.

**Other platforms** (Netlify, Railway, etc.):
```bash
# Build output: .output/
# Run: npm run build && npm run start
```

## ğŸ› Debugging

### Convex Function Logs
```bash
npx convex logs [deployment]  # View real-time logs
```

Also visible in Convex dashboard under "Logs" tab.

### Browser DevTools
- **React Query DevTools**: Inspect cached queries/mutations
- **Network**: See Convex HTTP requests
- **Console**: Check `convex/` function outputs (`console.log`)

### VS Code Debugging
Create `.vscode/launch.json`:
```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "type": "node",
      "request": "launch",
      "name": "Convex Functions",
      "program": "${workspaceFolder}/node_modules/.bin/convex",
      "args": ["dev"],
      "console": "integratedTerminal"
    }
  ]
}
```

## ğŸ“š Resources

- **Convex Docs**: https://docs.convex.dev
- **TanStack Router**: https://tanstack.com/router/latest
- **TanStack Query**: https://tanstack.com/query/latest
- **React 19**: https://react.dev
- **Tailwind CSS**: https://tailwindcss.com
- **TypeScript**: https://www.typescriptlang.org

## ğŸ¤ Contributing

See `.github/copilot-instructions.md` for AI agent guidelines.

## ğŸ“„ License

MIT
